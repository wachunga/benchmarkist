<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Transact</title>
	<link rel="stylesheet" href="main.css">
</head>
<body>
	<nav class="main-nav">
		<div>Bench Test</div>
	</nav>
	<div class="container">
		<h1 class="section-header">Transactions <span class="transaction-count"></span></h1>
		<table class="sum-table">
			<thead>
				<th>Date</th>
				<th>Company</th>
				<th>Account</th>
				<th class="sum-table-total"></th>
			</thead>
			<tbody>
				<tr>
					<td colspan="4">Loading...</td>
				</tr>
			</tbody>
		</table>
	</div>

<script>
	if (!fetch) {
		alert('Your browser is currently unsupported');
	}

	const transactionCountElement = document.querySelector('.transaction-count');
	const transactionTableBodyElement = document.querySelector('.sum-table tbody');
	const transactionTotalElement = document.querySelector('.sum-table-total');

	fetchTransactions().then(addResults);

	function fetchTransactions() {
		return fetch('/a/1/transactions?formatted=true&readable=true&dedupe=true')
			.then(function (response) {
				return response.json();
			});
	}

	function addResults(results) {
		transactionTotalElement.innerText = results.totalBalance;
		transactionCountElement.innerText = `(${results.transactions.length})`;
		transactionTableBodyElement.innerHTML = results.transactions.map(result => {
			const rowClass = 'row-' + result.Ledger.toLowerCase();
			return `
<tr class="${rowClass}">
	<td>${result.Date}</td>
	<td>${result.Company}</td>
	<td>${result.Ledger}</td>
	<td>${result.Amount}</td>
</tr>`;
		}).join('\n');
	}
</script>
</body>
</html>
